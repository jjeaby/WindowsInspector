<!DOCTYPE html>
<!-- saved from url=(0049)http://forum.sources.ru/index.php?showtopic=29381 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>Прогулка по окнам Windows -&gt; Форум на Исходниках.Ру</title>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta content="no-cache" http-equiv="no-cache">
    <meta name="keywords" content="исходник.ру, исходники.ру">
    <script src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/jquery.min.js.download"></script>
    
<link class="rss-link" rel="alternate" type="application/rss+xml" title="RSS" href="http://forum.sources.ru/yandex.php?t=29381">

    
     <link href="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/b3230f5cc047a2a5fd41ba856cf38dab-skin_main.scss.css" rel="stylesheet" type="text/css">

    <script type="text/javascript" src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/global.js.download"></script><script type="text/javascript" src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/keyb.js.download"></script><script type="text/javascript" src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/video.js.download"></script><script type="text/javascript" src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/topics.js.download"></script><script type="text/javascript" src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/jqcd.js.download"></script>
</head>
<body data-uid="0" data-shown-topic-id="29381">
<div id="ipbwrapper">
    <script type="text/javascript">var tid = 29381;
var base_url = "http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;";
var session_id = "0158f3cab61a88b671947cbc00279423";
var max_attach_size = "0";
var st = null;
var text_spoiler_hidden_text = "Скрытый текст";
var text_cancel = "Отмена";
var upload_attach_too_big = "Превышен максимальный размер файла, разрешенный для Вашей группы.";
var js_base_url = "http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&";
var text_enter_url = "Введите полный адрес ссылки";
var text_enter_url_name = "Введите название сайта";
var text_enter_email = "Введите электронный адрес";
var text_enter_email_name = "Введите имя для данного Email";
var text_enter_image = "Введите полный адрес картинки";
var text_spoiler = "Скрытый текст";
var text_quote = "Цитата";
var text_img = "Изображение";
var text_url = "Ссылка";
var text_list = "Список";
var error_no_url = "Вы должны ввести адрес";
var error_no_title = "Вы должны ввести название";
var error_no_email = "Вы должны ввести е-мэйл";
var error_no_email_name = "Вы должны ввести имя для е-мэйл";
var text_enter_spoiler = "Введите заголовок скрытого текста (можно оставить пустым)";
var text_enter_quote = "Введите имя автора цитируемого текста (можно оставить пустым)";
var tpl_q1 = "Введите номер страницы, к которой хотите перейти.";
</script>
    <table id="b-header">
<tbody><tr id="logostrip">
<td class="b-logo-wrapper"><a class="b-logo_link" href="http://www.sources.ru/" title="На главную"><img class="b-logo_img" src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/logo4.gif" alt="На главную" border="0"></a></td>

<td align="center" class="b-slogan-wrapper">
<!-- SLOGAN -->
</td>

<td class="b-header-banner-wrapper">

</td>
</tr>

<tr class="b-neighbor-links-wrapper">
<td class="b-neighbor-links-title">
Наши проекты:
</td>
<td class="b-neighbor-links" colspan="2">
<a class="b-neighbor-link b-neighbor-link_magazine" href="http://magazine.sources.ru/"><b>Журнал</b></a>
·
<a class="e-neighbor-link e-neighbor-link-discuz" href="http://discuz.ml/" title="Discuz! MultiLingual"><b>Discuz!ML</b></a>
·
<a class="b-neighbor-link b-neighbor-link_alglib" href="http://alglib.sources.ru/"><b>Алгоритмы</b></a>
·
<a class="b-neighbor-link b-neighbor-link_e-science" href="http://e-science.sources.ru/"><b>Естественные науки</b></a>
·
<a class="b-neighbor-link b-neighbor-link_wiki" href="http://wiki.sources.ru/"><b>Wiki</b></a>
·
<a class="b-neighbor-link b-neighbor-link_drkb" href="http://drkb.ru/" title="Delphi Resources Knowledge Base"><b>DRKB</b></a>
·
<a class="b-neighbor-link b-neighbor-link_donate" href="http://forum.sources.ru/donate.php"><b>Помощь&nbsp;проекту</b></a>
</td>
</tr>
</tbody></table>


<table width="100%" cellspacing="0" id="top-menu" class="b-hor_menu b-menu">
<tbody><tr align="center">
 <td class="b-menu-item b-menu-item-rules">
<a href="http://forum.sources.ru/rules.html" target="blank_" class="rules-link">ПРАВИЛА</a>
</td>
 <td class="b-menu-item b-menu-item-faq"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showtopic=50223">FAQ</a></td>
 <td class="b-menu-item b-menu-item-help"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Help">Помощь</a></td>
 <td class="b-menu-item b-menu-item-search"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Search&amp;f=75">Поиск</a></td>
 <td class="b-menu-item b-menu-item-members"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Members">Участники</a></td>
 <td class="b-menu-item b-menu-item-calendar"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=calendar">Календарь</a></td>
 <td class="b-menu-item b-menu-item-favorites "><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=fav&amp;show=1">Избранное</a></td>
 <td class="b-menu-item b-menu-item-store"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=store">DigiMania</a></td>
 <td class="b-menu-item b-menu-item-rss"><a href="http://forum.sources.ru/index.php?showtopic=81342">RSS</a></td>
</tr>
</tbody></table>


<table id="userlinks" class="b-user-links">
  <tbody><tr>
    <td>
        <span class="b-welcome-message"><span class="b-welcome-prefix">Здравствуйте,  </span>Гость<span class="b-welcome-suffix"> !</span></span> <span class="b-user-ip">[37.44.103.180]</span>
    </td>
    <td class="b-user-action-buttons-wrapper">
    <ul class="b-action-buttons b-user-action-buttons">
      <li class="b-action-button b-login-button"><a class="b-action-button-link" href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Login&amp;CODE=00">Не авторизованы?</a></li>
      <li class="b-action-button b-register-button"><a class="b-action-button-link" href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Reg&amp;CODE=00">Регистрация</a></li>
      <li class="b-action-button b-revalidate-button"><a class="b-action-button-link" href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Reg&amp;CODE=reval">Выслать повторно письмо для активации</a></li>
      <li class="b-action-button b-why_register-button"><a class="b-action-button-link" href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showtopic=50223">Что даёт регистрация на форуме?</a></li>
    </ul>
    </td>
  </tr>
</tbody></table>

    
    <table id="top-navigation" class="b-top-navigation-row" border="0" width="100%" cellspacing="0" cellpadding="0">
<tbody><tr>
<td class="b-navigation-wrapper"><ul class="b-breadcrumbs b-breadcrumbs-top"><li class="b-breadcrumbs-element"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;">Форум на Исходниках.RU</a></li><li class="b-breadcrumbs-element"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=SC&amp;c=6">FAQ</a></li><li class="b-breadcrumbs-element"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showforum=59">Delphi FAQ</a></li><li class="b-breadcrumbs-element"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showforum=75">Hello, World!</a></li></ul></td>
<td class="b-top-nav-banner-wrapper">
<!-- TOP NAV BANNER -->

<a target="_blank" href="http://www.msm.ru/"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/msm.gif" title="MSM - Аренда и размещение серверов" alt="msm.ru"></a>
</td>
<!-- DONATE 5rub FORM -->
<td class="b-donate-wrapper">
	<form action="https://money.yandex.ru/donate.xml" method="post">
		<input type="hidden" name="to" value="41001151000887">
		<input type="hidden" name="s5" value="5rub">

		<table class="donate">
		<colgroup><col align="right"><col width="50">
		</colgroup><tbody><tr>
			<td class="donate_text">
				<div>Нравится ресурс?</div>
			</td>
			<td rowspan="2" class="donate_image"><input type="image" src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/5rub_gold.png" title="Яндекс.Деньги"></td>
		</tr>
		<tr>
			<td class="donate_button"><input type="submit" title="Яндекс.Деньги" value="Дай пять"></td>
		</tr>
		</tbody></table>
	</form>
</td>
</tr>
</tbody></table>

    
<script language="javascript" type="text/javascript">
var
tid		    = "29381",
error_no_url        = "Вы должны ввести адрес",
error_no_title      = "Вы должны ввести название",
error_no_email      = "Вы должны ввести е-мэйл",
error_no_width      = "Вы должны ввести ширину",
error_no_height     = "Вы должны ввести высоту",
text_enter_url      = "Введите полный адрес ссылки",
text_enter_url_name = "Введите название сайта",
text_enter_image    = "Введите полный адрес картинки",
prompt_start        = "Введите текст для форматирования",
tt_prompt	    = "Копирование прямой ссылки этой темы для сохранения ссылки в буфере обмена вашего компьютера",
js_del_1	    = "Вы действительно хотите удалить это сообщение?",
js_del_2	    = "Не хотите, как хотите :)",
msg_no_title	    = "Необходимо ввести заголовок сообщения",
js_no_message	    = "Вы должны ввести текст сообщения!",
js_max_length	    = "Максимальная длина",
js_characters	    = "символов",
js_current	    = "Текущие символы",
error_no_url        = "Вы должны ввести адрес",
error_no_title      = "Вы должны ввести название",
error_no_email      = "Вы должны ввести е-мэйл",
error_no_width      = "Вы должны ввести ширину",
error_no_height     = "Вы должны ввести высоту",
text_enter_url      = "Введите полный адрес ссылки",
text_enter_url_name = "Введите название сайта",
text_enter_image    = "Введите полный адрес картинки",
prompt_start        = "Введите текст для форматирования",
MessageMax  	    = "",
Override    	    = "",
decline1 	    = "Отклонить",
decline2 	    = "Восстановить",
post_delete1 	    = "X",
post_delete2 	    = "Уд. %s дн.".replace("%s","0"),
solve1 		    = "Вопрос решен",
solve2 		    = "Вопрос не решен",
fav1		    = "Добавить в Избранное",
fav2		    = "Удалить из Избранного",
scroll_to	    = 0,
MessageMax          = parseInt(MessageMax);
if ( MessageMax < 0 ) MessageMax = 0;
</script>

<a name="top"></a>
<!--IBF.FORUM_RULES-->
<div class="b-topic-moderators-list">Модераторы: <a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showuser=19443">Rouse_</a>, <a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showuser=17347">jack128</a>, <a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showuser=12367">Krid</a></div>
<div class="topic-attached-links-contained"></div>
<div class="b-topic-close-reason"></div>
<table class="b-topic-header-buttons-row">
<tbody><tr>
 <td class="topic-pager pager b-top-pager-wrapper">&nbsp;&nbsp;</td>
 <td class="forum-buttons b-top-forum-buttons-wrapper"><ul class="b-action-buttons b-topic-header-buttons"></ul></td>
</tr>
</tbody></table>
<div id="PostsWrapper" class="tableborder b-topic-posts" data-topic-id="29381" data-topic-author-id="0">
  <div class="maintitle"><span class="topic-image"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/nav_m.gif" border="0" alt="&gt;"></span>&nbsp;<span class="b-posts__topic__title">Прогулка по окнам Windows</span><span class="b-posts__topic__description">, Обобщающие сведения</span></div>
  <div class="b-poll-wrapper"><!--{IBF.POLL}--></div>
  
  <div class="topic-links">
    <ul class="b-action-buttons b-action-buttons-vline b-topic-actions">
        <!--{IBF.START_NEW_POLL}-->
		<li class="b-action-button b-subscribe-button"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Track&amp;f=75&amp;t=29381">Подписаться на тему</a></li>
        <li class="b-action-button b-forward-button"><a class="forward-topic" href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Forward&amp;f=75&amp;t=29381">Сообщить другу</a></li>
        <li class="b-action-button b-print-button"><a class="print-topic" href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Print&amp;client=choose&amp;f=75&amp;t=29381">Скачать/распечатать тему</a></li>
		
	</ul>

</div>
	<div class="b-post__wrapper">
    <table class="b-post" id="post_201324" data-post-id="201324" data-post-author-id="8617">
    <tbody><tr class="b-post__headers-row">
       <td class="b-post__author-name"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/starmod.gif" border="0" alt="Senior Member" title="Senior Member"> <a name="entry201324"></a>
        <span class="b-post__author normalname" data-author-id="8617"><a onmouseover="get_name(&#39;[b]Forum_Bot[/b]&#39;);" href="javascript:Insert();">Forum_Bot</a></span>
       </td>
       <td class="b-post__header">
        <div class="b-post__info">
         <span class="postdetails"><span class="b-post__title"><span class="b-post__title__prefix">Сообщ.</span> <a class="b-post__title__number" title="Показать ссылку этой темы" href="http://forum.sources.ru/index.php?showtopic=29381#" onclick="link_to_post(201324); return false;">#1</a></span><span class="b-post__date__prefix">, </span><time class="b-post__date" datetime="Sun, 09 Nov 2003 11:17:12 +0000">09.11.03, 11:17</time></span>
         </div>
         <ul class="b-action-buttons b-post__actions"></ul>

      </td>
    </tr>
    <tr class="b-post__data-row">
      <td class="b-post__author-info post2">
        <div class="postdetails">
        <div class="b-post__author-avatar"></div>
        <div class="b-post__author-title">Main Bot</div>
        <div class="b-post__author-rank"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/pip.gif" border="0" alt="*"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/pip.gif" border="0" alt="*"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/pip.gif" border="0" alt="*"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/pip.gif" border="0" alt="*"></div>
        <div class="b-post__author-profile"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showuser=8617" target="_blank">Профиль</a> · <a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=Msg&amp;CODE=4&amp;MID=8617" target="_blank">PM</a></div>
        <div class="b-post__author-member_points"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=store&amp;code=showfine&amp;id=8617">Поощрения</a>: 18 Dgm<br></div>
        <div class="b-post__author-rep">Рейтинг (т): 2 <br></div>
        <div class="b-post__author-warns"></div>
        </div>
		
      </td>
      <td class="b-post__body post2">
        <div class="postcolor"><b>Прогулка по окнам Windows.</b>
<table width="100%" bgcolor="#FAEBD7" cellpadding="3" cellspacing="0" border="0">
<tbody><tr><td align="CENTER"><font color="#996600"><b>
Немного теории.</b></font></td></tr></tbody></table>
<p></p>
Всё или почти всё (хотя я не возьмусь сказать, что именно составляет исключение) в Windows имеет свой хэндл (Handle). Интересен перевод системой Сократ термина <handle> - &lt;Ручка&gt;, на нормальном техническом русском это будет дескриптор (определитель, идентификатор, описатель). Таким образом, handle - некий уникальный идентификатор любого ресурса Windows. Каждое окно имеет свой собственный дескриптор.
<p>Иерархия окон в системе представлена таким образом:</p>
<ul>
	<li>каждое окно имеет список подчинённых окон. Список может быть пустым, в случае, если стиль окна не предусматривает хранения подчинённых элементов. </li>
	<li>каждое окно имеет окно-владельца. Дескриптор окна-владельца будет нулевым (пустым), если окно имеет верхний уровень вложенности, например, главное окно программы. </li>
	<li>для каждого окна можно получить слудующее и предыдущее, в его уровне вложенности, окно. </li>
</ul>

Мы имеем древовидную структуру с возможностью навигации по дереву, как вверх и вниз по уровню вложенности, так и горизонтально. Горизонтальная навигация возможна исключительно по окнам, имеющим то же окно-владелец. Рассмотрим простенькую схемку:
<p align="center"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/schema.gif" width="388" height="140" border="0" alt="Иерархия окон"></p>
Для &lt;Окна 3&gt; - владелец &lt;Окно 1&gt;, окна своего уровня - &lt;Окно 3 :Окно N&gt;, и соответсвующие по рисунку, дочерние окна - &lt;Окно N+1 : N+M&gt;. При этом, непосредственно получить идентификаторы других окон, используя идетификатор исходного окна невозможно.

<p>Перейдём к иструментарию Windows API, позволяющему реализовать сказаное выше.</p>
<table width="100%" bgcolor="#FAEBD7" cellpadding="3" cellspacing="0" border="0">
<tbody><tr><td align="CENTER"><font color="#996600"><b>
Оконные функции WinAPI, используемые в данном проекте.</b></font></td></tr></tbody></table>
<p></p>
<tt>function GetWindow(hWnd: HWND; uCmd: UINT): HWND; </tt>
<p></p>
Функция возвращает дескриптор окна, с заданным положением в иерархии окон относительно заданного окна.
<ul>
	<li>hWnd - дескриптор исходного окна.</li>
	<li>uCmd - направление связи, т.е. вверх, вниз или по горизонтали.</li>
</ul>
Значения переменной uCmd:
<ul>
	<li>GW_CHILD - Возвращает дескриптор дочернего (подчинённого) окна, находящегося в верхней позиции Z-упорядочивания. В случае, если окно не имеет дочерних окон, возвращается 0.</li>
	<li>GW_HWNDFIRST - Возвращает дескриптор окна, находящегося в верхней позиции Z-упорядочивания того же уровня, что и исходное окно.</li>
	<li>GW_HWNDLAST - Возвращает дескриптор окна, находящегося в нижней позиции Z-упорядочивания того же уровня, что и исходное окно.</li>
	<li>GW_HWNDNEXT - Возвращает дескриптор окна, находящегося в следующей позиции Z-упорядочивания того же уровня, что и исходное окно.</li>
	<li>GW_HWNDPREV - Возвращает дескриптор окна, находящегося в предыдущей позиции Z-упорядочивания того же уровня, что и исходное окно.</li>
	<li>GW_OWNER - Возвращает дескриптор окна владельца исходного окна. Если окно имеет нулевой уровень вложенности, возвращается 0. </li>
</ul>
<p><strong>О Z-упорядочивании: </strong>
самое &lt;верхнее&gt; окно на экране имеет нулевую позицию, следующее, перекрываемое им окно - первую позицию, и так далее до самого &lt;нижней&gt; части экрана. Таким образом реализуется понятие трёхмерности, хотя в одной умной книжке я читал, что многооконная среда условно имеет 2.5-мерность (2.5D).
</p>
С помощью этой функции мы можем получить список всех окон системы несложной рекурсивной прогулкой по дереву (задача 1-го курса ВУЗа &lt;Обход дерева&gt;).
<p>Нам понадобятся ещё несколько функций WinAPI:</p>
<strong><tt>function GetWindowText(hWnd: HWND; lpString: PChar; nMaxCount: Integer): Integer;</tt></strong>
<p></p>
Функция получает текст окна по его идентификатору и возвращает считанную длину строки текста окна.
<ul>
	<li>hWnd - идентификатор окна.</li>
	<li>lpString - текст окна в переменной PChar. Переменную необходимо создать заранее.</li>
	<li>nMaxCount - длина строки lpString.</li>
</ul>
<strong><tt>function GetClassName(hWnd: HWND; lpClassName: PChar; nMaxCount: Integer): Integer;</tt></strong>

<ul>
	<li>hWnd - идентификатор окна.</li>
	<li>lpClassName - имя класса окна в переменной PChar. Переменную необходимо создать заранее.</li>
	<li>nMaxCount - длина строки lpClassName.</li>
</ul>
<strong><tt>function GetMenu(hWnd: HWND): HMENU;</tt></strong>
<br>
Функция возвращает идентификатор меню по переданному идентификатору окна. 

<p>Перейдём к непосредственному построению программы.</p>

<table width="100%" bgcolor="#FAEBD7" cellpadding="3" cellspacing="0" border="0">
<tbody><tr><td align="CENTER"><font color="#996600"><b>
Построение программы.</b></font></td></tr></tbody></table>
<p></p>
Запустим Delphi и создадим новое приложение в меню File-&gt;New Application.
<p></p>
Не будем отвлекаться на навороченный интерфейс, не сомневаюсь, что большинство делает это легко, как &lt;два байта переслать&gt; ;). Построим что-нибудь а-ля "Проводник". Обзовём главную форму fmMain, а главный модуль - Main.pas. Разместим на форме компоненты как показано на рисунке: 
<p align="center"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/form.gif" width="408" height="314" border="0" alt=""></p>
Слева на форме находится компонент Tree:TTreeView, а клиентскую часть занимает компонент List:TListView.

<p>Добавим в форму fmMain процедуру заполнения дерева FillTree следующего содержания:</p>
<pre><font color="#0000FF">// процедура заполнения дерева</font>
procedure TfmMain.FillTree;
var
  h,h1:THandle;
  Buffer:PChar;
  
<font color="#0000FF">// рекурсивная процедура заполнения дерева</font>
procedure RegisterWindow(hWnd:THandle;ParentTreeItem:TTreeNode);
var
  Node:PNode; <font color="#0000FF">// данные окна</font>
  TreeNode:TTreeNode; <font color="#0000FF">// узел дерева</font>
  h:THandle; <font color="#0000FF">// хэндл окна, промежуточная переменная</font>
begin
  <font color="#0000FF">// получение и сохранение информации об окне
  // создание переменной информации обокне</font>
  New(Node);
  <font color="#0000FF">// присвоение дескриптора</font>
  Node^.Handle:=hWnd;
  <font color="#0000FF">// получение текста окна</font>
  GetWindowText(hWnd,Buffer,256);
  Node^.Text:=Trim(StrPas(Buffer));
  <font color="#0000FF">// получение класса окна</font>
  GetClassName(hWnd,Buffer,255);
  Node^.CName:=Trim(StrPas(Buffer));
  <font color="#0000FF">// получение дескриптора меню окна</font>
  Node^.Menu:=GetMenu(hWnd);
  <font color="#0000FF">// размещение в дереве</font>
  TreeNode:=Tree.Items.AddChild(ParentTreeItem,'');
  <font color="#0000FF">// присвоение отображаемого текстового значения</font>
  if Node^.Text&lt;&gt;'' then TreeNode.Text:=Node^.Text
    else if Node^.CName&lt;&gt;'' then TreeNode.Text:=Node^.CName
      else TreeNode.Text:=IntToStr(Node^.Handle);
  <font color="#0000FF">// сохранение ссылки на информацию об окне в соответствующем узле дерева</font>
  TreeNode.Data:=Node;
  <font color="#0000FF">// Рекурсивные вызовы
  // получение поддчинённых элементов</font>
  h:=GetWindow(hWnd,gw_Child);
  if h&lt;&gt;0 then
    RegisterWindow(h,TreeNode);
  <font color="#0000FF">// получение элеметов того же уровня</font>
  h:=GetWindow(hWnd,gw_hWndNext);
  if h&lt;&gt;0 then
    RegisterWindow(h,ParentTreeItem);
end;

begin
  <font color="#0000FF">// сообщение в строке статуса</font>
  Status.SimpleText:=<font color="#996600">'Обновление информации об окнах ...'</font>;
  Application.ProcessMessages;
  <font color="#0000FF">// выключение отображения изменений дерева</font>
  Tree.Items.BeginUpdate;
  <font color="#0000FF">// очистка дерева</font>
  Tree.Items.Clear;
  <font color="#0000FF">// создание буфера для работы с PChar</font>
  Buffer:=StrAlloc(256);
  <font color="#0000FF">// Получаем хэндл текущего окна</font>
  h1:=Handle;
  repeat
    <font color="#0000FF">// получаем хэндл окна-владельца</font>
    h:=GetWindow(h1,GW_OWNER);
    <font color="#0000FF">// если не окно верхнего уровня, то ищем дальше</font>
    if h&lt;&gt;0 then begin
      h1:=h;
    end;
  until h=0;
  <font color="#0000FF">// находим первое верхнее окно</font>
  h:=GetWindow(h1,GW_HWNDFIRST);
  <font color="#0000FF">// запуск рекурсии</font>
  RegisterWindow(h,nil);
  <font color="#0000FF">// задание выделенного элемента дерева</font>
  Tree.Selected:=Tree.Items[0];
  <font color="#0000FF">// включение отображения изменений дерева</font>
  Tree.Items.EndUpdate;
  <font color="#0000FF">// удаление буфера для работы с PChar</font>
  StrDispose(Buffer);
  <font color="#0000FF">// сообщение в строке статуса</font>
  Status.SimpleText:=<font color="#996600">'Готово.'</font>;
end;
</pre>
<p></p>
Теперь попробуем в ней разобраться (смотри по тексту процедуры). Status - класс TStatus Bar. Сообщим в строке статуса, что мы обновляем информацию. Выключим отображение обновления дерева для того, чтобы ничего в процессе обновления у нас на экране не дёргалось. Очистим дерево и создадим переменную Buffer, в которую будем записывать строковые результаты выполнения функций WinAPI.
<p></p>
Следующий этап - добраться до самого верхнего и самого первого окна системы. Мы вызываем функцию GetWindow с параметром GW_OWNER - получение окна-владельца, начиная с главного окна программы. Получив окно, не имеющее владельца, находим для этого окна окно с нулевым Z-порядком, вызвав функцию GetWindow с параметром GW_HWNDFIRST - получение первого окна в данном уровне вложенности. Теперь мы можем начать обход дерева окон, начиная с самого первого по порядку возрастания вложенности и Z-порядка, вызвав рекурсивную процедуру RegisterWindow.
<p></p>
Как известно, у класса TTreeNode - узла дерева - есть поле Data:Pointer. В это поле можно записывать любые ссылки на данные, которые требуется ассоциировать с узлом дерева. Создадим структуру данных для хранения информации об окне.
<pre><font color="#0000FF">// тип для хранения информации об окне</font>
TNode=record
  Handle:THandle; <font color="#0000FF">// хэндл окна</font>
  Text:string[255]; <font color="#0000FF">// текст окна</font>
  CName:string[255]; <font color="#0000FF">// имя класса</font>
  Menu:HMenu; <font color="#0000FF">// хендл меню</font>
end;
PNode=^TNode; <font color="#0000FF">// указатель на структуру</font>
</pre>
При нахождении очередного окна будем создавать динамическую переменную типа PNode и её значение записывать в поле TTreeNode.Data. Итак, мы знаем &lt;первое верхнее&gt; окно. Передадим его в процедуру RegisterWindow. Также в эту процедуру передаётся ссылка на узел дерева, к которому добавляются узлы подчинёных окон. В первом случае вызова рекурсии, эта ссылка равна nil.
<p>Следующие действия просты до безобразия (процедура RegisterWindow):</p>
<ul>
	<li>создать переменную описания окна; </li>
	<li>получить по заданному идентификатору описанными ранее функциями WinAPI текст, имя класса и идентификатор меню, и записать эти значения в переменную окна; </li>
	<li>создать узел дерева и присвоить ему перменную окна, задав владельца узла и присвоив ему текстовое значение; </li>
	<li>получить идентификатор дочернего окна, и если идентификатор не равен 0, рекурсивно его обработать, передав в RegisterWindow полученные параметры. При этом, в процедуру передаётся идентификатор полученного дочернего окна и только что созданный узел дерева; </li>
	<li>получить идентификатор следующего за текущим окна того же уровня вложенности. И если он не равен 0, передать в RegisterWindow полученный идентификатор и внешний параметр ParentTreeItem. При этом узлы дерева будут добавляться на том же уровне, что и текущий узел.</li>
</ul>
Если мы вызовем процедуру FillTree в событии FormCreate, то дерево автоматически заполнится при запуске программы. Создадим действие acRefresh:TAction и свяжем его с кнопкой обновления, расположенной на форме. В обработке запуска действия напишем такой код:

<pre><font color="#0000FF">// действие "обновить"</font>
procedure TfmMain.acRefreshExecute(Sender: TObject);
begin
  <font color="#0000FF">// заполнение дерева</font>
  FillTree;
end;
</pre>
Теперь мы можем принудительно обновлять список. Перейдём к отображению всей собранной информации об окне в компоненте List:TListView. Обработаем событие TTreeView.OnChange так:

<pre><font color="#0000FF">// событие изменения выделенного элемента дерева</font>
procedure TfmMain.TreeChange(Sender: TObject; Node: TTreeNode);

<font color="#0000FF">// добавление в List строки</font>
procedure AddItem(Name,Value:String);
var
  Item:TListItem;
begin
  Item:=List.Items.Add();
  Item.Caption:=Name;
  Item.SubItems.Add(Value);
end;

begin
  <font color="#0000FF">// выключение обновления</font>
  List.Items.BeginUpdate;
  <font color="#0000FF">// очистка</font>
  List.Items.Clear;
  <font color="#0000FF">// добавление элементов</font>
  if (Node&lt;&gt;nil) and (Node.Data&lt;&gt;nil) then begin
     AddItem(<font color="#996600">'Текст'</font>,TNode(Node.Data^).Text);
    AddItem(<font color="#996600">'Класс'</font>,TNode(Node.Data^).CName);
    AddItem(<font color="#996600">'Дескриптор окна'</font>,IntToStr(TNode(Node.Data^).Handle));
    AddItem(<font color="#996600">'Дескриптор меню'</font>,IntToStr(TNode(Node.Data^).Menu));
  end;
  <font color="#0000FF">// включение обновления</font>
  List.Items.EndUpdate;
end;
</pre>
На выделение соответсвующего элемента дерева (Node:TTreeNode), добавляем в компонент List:TListView строки со значениями всех полей записи PNode^.
<div align="center"><h3>Всё!</h3></div>
Мы имеем информацию о всех окнах и используя идентификатор окна можем получить доступ к ОЧЕНЬ БОЛЬШОМУ КОЛИЧЕСТВУ параметров окна через WinAPI
<p></p>
<table width="100%" bgcolor="#FAEBD7" cellpadding="3" cellspacing="0" border="0">
<tbody><tr><td align="CENTER"><font color="#996600"><b>
И зачем всё это нужно?</b></font></td></tr></tbody></table>
<p></p>
Проиллюстрируем четырьмя примерами:

<ul>
<li>Спрятать ненужное (читаем, надоевшее) окно. Например, окно системы баннерных показов. Делается так:
<br><tt>ShowWindow(TNode(Tree.Selected.Data^).Handle,sw_Hide).</tt>
<br>Правда эффективного скрытия этого окна нужно работать с собщениями cерии ABM_*, но это другая история. 
</li><li>Показать упрятанное окно. Обратное действие:
<br><tt>ShowWindow(TNode(Tree.Selected.Data^).Handle,sw_Show).</tt>
<br>Например, слетела панель с кнопкой "Пуск". Все значки в системном трее пропали. Показать окно не представляет проблемы. 
</li><li>Разрешить запрещенный элемент управления:
<br><tt>EnableWindow(TNode(Tree.Selected.Data^).Handle,True).</tt>
<br>Для чего это нужно, не будем даже и говорить. 
</li><li>Убить окно:
<br><tt>PostMessage(TNode(Tree.Selected.Data^).Handle,wm_Close,0,0).</tt>
<br>Объяснение - см. пункт 3. 
</li></ul>
<p>Cкачать проект: 
</p><ul>
	<li><a href="http://delphi.mtu-net.ru/zip/wbsrc.zip">Исходный код</a> (8 К)</li>
	<li><a href="http://delphi.mtu-net.ru/zip/wbexec.zip">Исполняемый файл</a> (213 К)</li>
</ul>
<p></p>

<p align="right"><strong><a href="mailto:maxx0@mail.ru">Максим Мазитов</a></strong><br>
май 2001г<br>
Специально для <a href="http://www.delphikingdom.com/"><b>Королевства Delphi</b></a></p> </handle></div>
        
      </td>
    </tr>

    </tbody></table>
    </div>    <div class="b-posts-separator"></div>	<div class="b-post__wrapper">
    <table class="b-post" id="post_202187" data-post-id="202187" data-post-author-id="0">
    <tbody><tr class="b-post__headers-row">
       <td class="b-post__author-name"> <a name="entry202187"></a>
        <span class="b-post__author unreg" data-author-id="0"><a onmouseover="get_name(&#39;[b]Song[/b]&#39;);" href="javascript:Insert();"><span class="unreg">Song</span></a></span>
       </td>
       <td class="b-post__header">
        <div class="b-post__info">
         <span class="postdetails"><span class="b-post__title"><span class="b-post__title__prefix">Сообщ.</span> <a class="b-post__title__number" title="Показать ссылку этой темы" href="http://forum.sources.ru/index.php?showtopic=29381#" onclick="link_to_post(202187); return false;">#2</a></span><span class="b-post__date__prefix">, </span><time class="b-post__date" datetime="Sun, 09 Nov 2003 11:18:39 +0000">09.11.03, 11:18</time></span>
         </div>
         <ul class="b-action-buttons b-post__actions"></ul>

      </td>
    </tr>
    <tr class="b-post__data-row">
      <td class="b-post__author-info post1">
        <div class="postdetails">
        <div class="b-post__author-avatar"></div>
        <div class="b-post__author-title">Unregistered</div>
        <div class="b-post__author-rank"></div>
        <div class="b-post__author-profile"></div>
        <div class="b-post__author-member_points"></div>
        <div class="b-post__author-rep"></div>
        <div class="b-post__author-warns"></div>
        </div>
		
      </td>
      <td class="b-post__body post1">
        <div class="postcolor">  Оригинал статьи расположен по адресу <a href="http://www.delphikingdom.com/helloworld/windows.htm" target="_blank">http://www.delphikingdom.com/helloworld/windows.htm</a>   </div>
        
      </td>
    </tr>

    </tbody></table>
    </div>    <div class="b-posts-separator"></div><div class="activeuserstrip b-active-users-summary">0 пользователей читают эту тему (0 гостей и 0 скрытых пользователей)</div>
<div class="row2 b-active-users-detailed">0 пользователей: </div>
<div class="activeuserstrip b-topic-bottom-navigation-buttons-wrapper">
<ul class="b-topic-bottom-navigation-buttons b-action-buttons b-action-buttons-vline">
<li class="b-action-button b-topic-navigation-previous"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showtopic=29381&amp;view=old">Предыдущая тема</a></li>
<li class="b-action-button b-topic-navigation-current"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showforum=75">Hello, World!</a></li>
<li class="b-action-button b-topic-navigation-next"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showtopic=29381&amp;view=new">Следующая тема</a></li>
</ul>
</div></div>
<div class="b-posts-bottom-row clearfix">
	<div class="b-bottom-breadcrumbs-wrapper"><ul class="b-breadcrumbs b-breadcrumbs-bottom    "><li class="b-breadcrumbs-element"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;">Форум на Исходниках.RU</a></li><li class="b-breadcrumbs-element"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;act=SC&amp;c=6">FAQ</a></li><li class="b-breadcrumbs-element"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showforum=59">Delphi FAQ</a></li><li class="b-breadcrumbs-element"><a href="http://forum.sources.ru/index.php?s=0158f3cab61a88b671947cbc00279423&amp;showforum=75">Hello, World!</a></li></ul></div>
	<div class="b-report-wrapper b-block-right"></div>
	<div class="b-bottom-pages-wrapper"></div>
	<div class="b-bottom-topic-actions-wrapper"><ul class="b-action-buttons b-topic-footer-buttons"></ul></div>
</div>
<div id="bottom-close-reason-wrapper" class="b-close-reason-wrapper"></div>
<div class="b-modpanel-wrapper"></div>
<div class="b-multimod_panel-wrapper"></div>

<!--IBF.QUICK_REPLY_OPEN-->
<br>
<div align="right"></div>
<br>
      <div class="b-script-execution-stats">[ Script Execution time: 0,0896 ] &nbsp; [ 17 queries used ] &nbsp; [ Generated: 22.04.17, 12:39 GMT ] &nbsp; </div>

    <noindex><!-- Copyright Information -->

<div align="center" class="copyright">Powered by <a rel="nofollow" href="http://www.invisionboard.com/" target="_blank">Invision Power Board</a>(U) v1.2 © 2003 &nbsp;<a rel="nofollow" href="http://www.invisionpower.com/" target="_blank">IPS, Inc.</a></div>
</noindex>
    <table width="100%">
        <tbody><tr>
            <td><div align="center"></div></td>
            <td align="center"></td>
        </tr>
    </tbody></table>

    <noindex>

        <!--Rating@Mail.ru COUNTER-->
        <script language="JavaScript" type="text/javascript"><!--
            d = document;
            var a = '';
            a += ';r=' + escape(d.referrer)
            js = 10//--></script>
        <script language="JavaScript1.1" type="text/javascript"><!--
            a += ';j=' + navigator.javaEnabled()
            js = 11//--></script>
        <script language="JavaScript1.2" type="text/javascript"><!--
            s = screen;
            a += ';s=' + s.width + '*' + s.height
            a += ';d=' + (s.colorDepth ? s.colorDepth : s.pixelDepth)
            js = 12//--></script>
        <script language="JavaScript1.3" type="text/javascript"><!--
            js = 13//--></script>
        <script language="JavaScript" type="text/javascript"><!--
            d.write('<a href="http://top.mail.ru/jump?from=89876"' +
            ' target="_top"><img src="http://df.c5.b1.a0.top.mail.ru/counter' +
            '?id=89876;t=57;js=' + js + a + ';rand=' + Math.random() +
            '" alt="Rating@Mail.ru"' + ' border="0" height="1" width="1"/></a>')
            if (11 < js)d.write('<' + '!-- ')//--></script><a href="http://top.mail.ru/jump?from=89876" target="_top"><img src="./Прогулка по окнам Windows -_ Форум на Исходниках.Ру_files/counter" alt="Rating@Mail.ru" border="0" height="1" width="1"></a><!-- 
        <noscript><a
                target="_top" href="http://top.mail.ru/jump?from=89876"><img
                    src="http://df.c5.b1.a0.top.mail.ru/counter?js=na;id=89876;t=57"
                    border="0" height="1" width="1"
                    alt="Rating@Mail.ru"/></a></noscript>
        <script language="JavaScript" type="text/javascript"><!--
            if (11 < js)d.write('--' + '>')//-->
        <!--/Rating@Mail.ru COUNTER-->


    </noindex>

</div>
<!-- <script type='text/javascript'>if(window.comboInit)setTimeout('comboInit()',10)</script> -->



</body></html>